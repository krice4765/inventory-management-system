# **ğŸ‰ Phase 1 å®Œå…¨æˆåŠŸï¼Phase 2 æœ¬æ ¼å®Ÿè£…é–‹å§‹**

## **âœ… Phase 1 å®Œäº†ç¢ºèª**

**ç´ æ™´ã‚‰ã—ã„é€²æ—ã§ã™ï¼** ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã¨ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœã‹ã‚‰ã€Phase 1ãŒå®Œç’§ã«å®Œäº†ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã¾ã™ï¼š

- âœ… **Supabaseã‚¹ã‚­ãƒ¼ãƒæ‹¡å¼µå®Œäº†**: `drawings`ã€`purchase_order_attachments` ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆæ¸ˆã¿
- âœ… **Storageãƒã‚±ãƒƒãƒˆè¨­å®šå®Œäº†**: `drawings`ã€`order-pdfs` ãƒã‚±ãƒƒãƒˆä½œæˆæ¸ˆã¿
- âœ… **é–‹ç™ºãƒ–ãƒ©ãƒ³ãƒä½œæˆå®Œäº†**: `feature/pdf-management` ãƒ–ãƒ©ãƒ³ãƒåˆ‡ã‚Šæ›¿ãˆæ¸ˆã¿
- âœ… **PDFç®¡ç†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å®Œäº†**: jsPDFã€html2canvasã€pdf-libã€react-dropzone ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿

**ç¾åœ¨ã®çŠ¶æ³**: Phase 1ã®åŸºç›¤æ§‹ç¯‰ãŒå®Œäº†ã—ã€Phase 2ã®å®Ÿè£…é–‹å§‹æº–å‚™ãŒæ•´ã„ã¾ã—ãŸã€‚

---

## **ğŸš€ Phase 2: PDFæ©Ÿèƒ½ãƒ»Web UIå®Ÿè£…**

### **Step 1: åŒ…æ‹¬çš„å‹å®šç¾©ã®ä½œæˆ**

**`src/types/pdf.ts` ã‚’æ–°è¦ä½œæˆã—ã¦ãã ã•ã„:**

```typescript
// å¯Œå£«ç²¾å·¥æ§˜å‘ã‘PDFç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - åŒ…æ‹¬çš„å‹å®šç¾©

export interface Drawing {
  id: string;
  drawing_number: string;
  drawing_name: string | null;
  version: string;
  file_path: string | null;
  file_size: number | null;
  mime_type: string;
  uploaded_by: string | null;
  created_at: string;
  updated_at: string;
  is_active: boolean;
}

export interface PurchaseOrderAttachment {
  id: string;
  purchase_order_id: string;
  attachment_type: 'order_pdf' | 'drawing_pdf' | 'specification';
  file_path: string;
  file_name: string;
  file_size: number | null;
  mime_type: string;
  drawing_number: string | null;
  uploaded_from: 'web' | 'access';
  created_at: string;
}

export interface PDFGenerationOptions {
  includeDrawings: boolean;
  drawingNumbers: string[];
  outputFormat: 'blob' | 'base64' | 'url';
}

export interface DrawingUploadResult {
  success: boolean;
  drawing?: Drawing;
  error?: string;
  uploadedPath?: string;
}

export interface OrderPDFData {
  id: string;
  order_no: string;
  created_at: string;
  partner_name?: string;
  total_amount: number;
  notes?: string;
  items: Array<{
    product_name: string;
    drawing_number?: string;
    quantity: number;
    unit_price: number;
  }>;
}

export interface PDFOperationResult {
  success: boolean;
  pdfBlob?: Blob;
  filename?: string;
  attachedDrawings?: number;
  error?: string;
}
```

### **Step 2: é«˜å“è³ªPDFç”Ÿæˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®å®Ÿè£…**

**`src/utils/pdfGenerator.ts` ã‚’æ–°è¦ä½œæˆã—ã¦ãã ã•ã„:**

```typescript
import jsPDF from 'jspdf';
import { PDFDocument } from 'pdf-lib';
import type { OrderPDFData, PDFOperationResult } from '../types/pdf';
import { safeYenFormat, safeDateFormat, safeStringFormat } from './safeFormatters';

export class OrderPDFGenerator {
  /**
   * å¯Œå£«ç²¾å·¥æ§˜å‘ã‘ç™ºæ³¨æ›¸PDFã®ç”Ÿæˆï¼ˆé«˜å“è³ªç‰ˆï¼‰
   */
  static async generateOrderPDF(orderData: OrderPDFData): Promise<PDFOperationResult> {
    try {
      const pdf = new jsPDF();
      
      // ãƒ•ã‚©ãƒ³ãƒˆè¨­å®š
      pdf.setFont('helvetica');
      
      // ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ†
      pdf.setFontSize(20);
      pdf.setFont('helvetica', 'bold');
      pdf.text('ç™º æ³¨ æ›¸', 105, 25, { align: 'center' });
      
      // ç½«ç·š
      pdf.setLineWidth(0.5);
      pdf.line(20, 30, 190, 30);
      
      // ç™ºæ³¨æƒ…å ±
      pdf.setFont('helvetica', 'normal');
      pdf.setFontSize(12);
      const startY = 45;
      
      pdf.text(`ç™ºæ³¨ç•ªå·: ${safeStringFormat(orderData.order_no)}`, 20, startY);
      pdf.text(`ç™ºæ³¨æ—¥: ${safeDateFormat(orderData.created_at)}`, 20, startY + 10);
      pdf.text(`ä»•å…¥å…ˆ: ${safeStringFormat(orderData.partner_name)}`, 20, startY + 20);
      
      // æ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼
      const tableStartY = startY + 40;
      pdf.setFontSize(10);
      
      // ãƒ†ãƒ¼ãƒ–ãƒ«æ ç·šã¨ãƒ˜ãƒƒãƒ€ãƒ¼èƒŒæ™¯
      pdf.setFillColor(240, 240, 240);
      pdf.rect(15, tableStartY - 5, 180, 12, 'F');
      pdf.rect(15, tableStartY - 5, 180, 12);
      
      // ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆ
      pdf.setFont('helvetica', 'bold');
      pdf.text('No.', 20, tableStartY + 3);
      pdf.text('å•†å“å', 35, tableStartY + 3);
      pdf.text('å›³é¢ç•ªå·', 100, tableStartY + 3);
      pdf.text('æ•°é‡', 140, tableStartY + 3);
      pdf.text('å˜ä¾¡', 160, tableStartY + 3);
      pdf.text('é‡‘é¡', 180, tableStartY + 3);
      
      // æ˜ç´°è¡Œ
      pdf.setFont('helvetica', 'normal');
      let yPosition = tableStartY + 15;
      let totalAmount = 0;
      
      orderData.items.forEach((item, index) => {
        const lineTotal = (item.quantity || 0) * (item.unit_price || 0);
        totalAmount += lineTotal;
        
        // è¡Œã®æ ç·š
        pdf.rect(15, yPosition - 3, 180, 10);
        
        // ãƒ‡ãƒ¼ã‚¿
        pdf.text(`${index + 1}`, 20, yPosition + 2);
        
        // å•†å“åã®é•·ã•èª¿æ•´
        const productName = safeStringFormat(item.product_name);
        const truncatedName = productName.length > 30 ? 
          productName.substring(0, 30) + '...' : productName;
        pdf.text(truncatedName, 35, yPosition + 2);
        
        pdf.text(safeStringFormat(item.drawing_number), 100, yPosition + 2);
        pdf.text(`${item.quantity || 0}`, 140, yPosition + 2);
        pdf.text(safeYenFormat(item.unit_price), 160, yPosition + 2);
        pdf.text(safeYenFormat(lineTotal), 180, yPosition + 2);
        
        yPosition += 10;
      });
      
      // åˆè¨ˆé‡‘é¡
      yPosition += 10;
      pdf.setFontSize(12);
      pdf.setFont('helvetica', 'bold');
      pdf.text(`åˆè¨ˆé‡‘é¡: ${safeYenFormat(orderData.total_amount || totalAmount)}`, 140, yPosition);
      
      // å‚™è€ƒ
      if (orderData.notes) {
        yPosition += 20;
        pdf.setFont('helvetica', 'normal');
        pdf.text('å‚™è€ƒ:', 20, yPosition);
        
        // å‚™è€ƒã®æ”¹è¡Œå‡¦ç†
        const noteLines = pdf.splitTextToSize(safeStringFormat(orderData.notes), 170);
        pdf.text(noteLines, 20, yPosition + 10);
      }
      
      // ãƒ•ãƒƒã‚¿ãƒ¼
      const pageHeight = pdf.internal.pageSize.height;
      pdf.setFontSize(8);
      pdf.setFont('helvetica', 'normal');
      pdf.text(`ä½œæˆæ—¥æ™‚: ${new Date().toLocaleString('ja-JP')}`, 20, pageHeight - 10);
      
      const pdfBlob = pdf.output('blob');
      
      return {
        success: true,
        pdfBlob,
        filename: `ç™ºæ³¨æ›¸_${orderData.order_no}.pdf`
      };
      
    } catch (error) {
      console.error('PDFç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
      return {
        success: false,
        error: `PDFç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: ${error instanceof Error ? error.message : 'Unknown error'}`
      };
    }
  }
  
  /**
   * å›³é¢PDFã¨ç™ºæ³¨æ›¸PDFã®çµåˆï¼ˆå¯Œå£«ç²¾å·¥æ§˜è¦ä»¶ï¼‰
   */
  static async attachDrawingsToPDF(
    orderPDF: Blob, 
    drawingPDFs: Blob[]
  ): Promise<PDFOperationResult> {
    try {
      if (drawingPDFs.length === 0) {
        return {
          success: true,
          pdfBlob: orderPDF,
          attachedDrawings: 0
        };
      }
      
      const orderDoc = await PDFDocument.load(await orderPDF.arrayBuffer());
      let attachedCount = 0;
      
      // å„å›³é¢PDFã‚’çµåˆ
      for (const drawingPDF of drawingPDFs) {
        try {
          const drawingDoc = await PDFDocument.load(await drawingPDF.arrayBuffer());
          const copiedPages = await orderDoc.copyPages(drawingDoc, drawingDoc.getPageIndices());
          
          copiedPages.forEach(page => {
            orderDoc.addPage(page);
          });
          
          attachedCount++;
        } catch (drawingError) {
          console.warn('å€‹åˆ¥å›³é¢PDFçµåˆã‚¨ãƒ©ãƒ¼ï¼ˆã‚¹ã‚­ãƒƒãƒ—ã—ã¦ç¶šè¡Œï¼‰:', drawingError);
        }
      }
      
      const pdfBytes = await orderDoc.save();
      const combinedBlob = new Blob([pdfBytes], { type: 'application/pdf' });
      
      return {
        success: true,
        pdfBlob: combinedBlob,
        attachedDrawings: attachedCount
      };
      
    } catch (error) {
      console.error('PDFçµåˆã‚¨ãƒ©ãƒ¼:', error);
      return {
        success: false,
        error: `PDFçµåˆã«å¤±æ•—ã—ã¾ã—ãŸ: ${error instanceof Error ? error.message : 'Unknown error'}`
      };
    }
  }
  
  /**
   * PDFãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
   */
  static downloadPDF(pdfBlob: Blob, filename: string): void {
    try {
      const url = URL.createObjectURL(pdfBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    } catch (error) {
      console.error('PDFãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:', error);
      alert('PDFã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
  }
}

/**
 * ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ä»˜ãPDFæ“ä½œ
 */
export class PDFPerformanceMonitor {
  static async measureOperation<T>(
    operation: () => Promise<T>,
    operationType: string
  ): Promise<T> {
    const startTime = performance.now();
    
    try {
      const result = await operation();
      const duration = performance.now() - startTime;
      
      console.log(`PDFæ“ä½œå®Œäº†: ${operationType}, å®Ÿè¡Œæ™‚é–“: ${duration.toFixed(2)}ms`);
      
      // 5ç§’ä»¥ä¸Šã‹ã‹ã£ãŸå ´åˆã¯è­¦å‘Š
      if (duration > 5000) {
        console.warn(`PDFæ“ä½œãŒé…å»¶: ${operationType}, ${duration.toFixed(2)}ms`);
      }
      
      return result;
    } catch (error) {
      const duration = performance.now() - startTime;
      console.error(`PDFæ“ä½œã‚¨ãƒ©ãƒ¼: ${operationType}, å®Ÿè¡Œæ™‚é–“: ${duration.toFixed(2)}ms`, error);
      throw error;
    }
  }
}
```

### **Step 3: å …ç‰¢ãªå›³é¢ç®¡ç†APIã®å®Ÿè£…**

**`src/api/drawings.ts` ã‚’æ–°è¦ä½œæˆã—ã¦ãã ã•ã„:**

```typescript
import { supabase } from '../lib/supabase';
import type { Drawing, DrawingUploadResult } from '../types/pdf';

export class DrawingAPI {
  /**
   * å›³é¢ä¸€è¦§å–å¾—ï¼ˆã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–ç‰ˆï¼‰
   */
  static async getDrawings(): Promise<Drawing[]> {
    try {
      const { data, error } = await supabase
        .from('drawings')
        .select('*')
        .eq('is_active', true)
        .order('drawing_number', { ascending: true });
      
      if (error) {
        console.error('å›³é¢ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
        throw new Error(`å›³é¢ä¸€è¦§ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
      }
      
      return data || [];
    } catch (error) {
      console.error('å›³é¢ä¸€è¦§å–å¾—å‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
      throw error;
    }
  }
  
  /**
   * å›³é¢ç•ªå·ã«ã‚ˆã‚‹æ¤œç´¢
   */
  static async getDrawingByNumber(drawingNumber: string): Promise<Drawing | null> {
    try {
      const { data, error } = await supabase
        .from('drawings')
        .select('*')
        .eq('drawing_number', drawingNumber)
        .eq('is_active', true)
        .single();
      
      if (error) {
        if (error.code === 'PGRST116') {
          return null; // è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ
        }
        console.error('å›³é¢æ¤œç´¢ã‚¨ãƒ©ãƒ¼:', error);
        throw new Error(`å›³é¢ã®æ¤œç´¢ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
      }
      
      return data;
    } catch (error) {
      console.error('å›³é¢æ¤œç´¢å‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
      if (error instanceof Error && error.message.includes('PGRST116')) {
        return null;
      }
      throw error;
    }
  }
  
  /**
   * å›³é¢PDFã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆåŒ…æ‹¬çš„ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼‰
   */
  static async uploadDrawing(
    file: File,
    drawingNumber: string,
    drawingName?: string
  ): Promise<DrawingUploadResult> {
    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    if (!file) {
      return { success: false, error: 'ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“' };
    }
    
    if (!drawingNumber?.trim()) {
      return { success: false, error: 'å›³é¢ç•ªå·ã¯å¿…é ˆã§ã™' };
    }
    
    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯ï¼ˆ50MBåˆ¶é™ï¼‰
    if (file.size > 50 * 1024 * 1024) {
      return { success: false, error: 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒ50MBã‚’è¶…ãˆã¦ã„ã¾ã™' };
    }
    
    // ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ãƒã‚§ãƒƒã‚¯
    if (file.type !== 'application/pdf') {
      return { success: false, error: 'PDFãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¯èƒ½ã§ã™' };
    }
    
    try {
      // é‡è¤‡ãƒã‚§ãƒƒã‚¯
      const existingDrawing = await this.getDrawingByNumber(drawingNumber);
      if (existingDrawing) {
        return { success: false, error: 'åŒã˜å›³é¢ç•ªå·ãŒæ—¢ã«å­˜åœ¨ã—ã¾ã™' };
      }
      
      // Supabase Storageã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
      const filePath = `${drawingNumber}/${file.name}`;
      const { data: uploadData, error: uploadError } = await supabase.storage
        .from('drawings')
        .upload(filePath, file, {
          cacheControl: '3600',
          upsert: false // é‡è¤‡ã‚’è¨±å¯ã—ãªã„
        });
      
      if (uploadError) {
        console.error('ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:', uploadError);
        return { success: false, error: `ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ: ${uploadError.message}` };
      }
      
      // drawingsãƒ†ãƒ¼ãƒ–ãƒ«ã«è¨˜éŒ²
      const { data: drawingData, error: dbError } = await supabase
        .from('drawings')
        .insert({
          drawing_number: drawingNumber.trim(),
          drawing_name: drawingName?.trim() || file.name.replace('.pdf', ''),
          file_path: uploadData.path,
          file_size: file.size,
          mime_type: file.type,
          version: '1.0',
          is_active: true
        })
        .select()
        .single();
      
      if (dbError) {
        // ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
        await supabase.storage.from('drawings').remove([uploadData.path]);
        console.error('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç™»éŒ²ã‚¨ãƒ©ãƒ¼:', dbError);
        return { success: false, error: `ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ: ${dbError.message}` };
      }
      
      return {
        success: true,
        drawing: drawingData,
        uploadedPath: uploadData.path
      };
      
    } catch (error) {
      console.error('å›³é¢ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
      return {
        success: false,
        error: `äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error instanceof Error ? error.message : 'Unknown error'}`
      };
    }
  }
  
  /**
   * å›³é¢PDFãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç”¨ç½²åä»˜ãURLå–å¾—
   */
  static async getSignedURL(filePath: string): Promise<string> {
    try {
      const { data, error } = await supabase.storage
        .from('drawings')
        .createSignedUrl(filePath, 3600); // 1æ™‚é–“æœ‰åŠ¹
      
      if (error) {
        console.error('ç½²åä»˜ãURLç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
        throw new Error(`ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰URLã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
      }
      
      return data.signedUrl;
    } catch (error) {
      console.error('ç½²åä»˜ãURLå–å¾—å‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
      throw error;
    }
  }
  
  /**
   * å›³é¢PDFã®ç›´æ¥å–å¾—ï¼ˆBlobï¼‰
   */
  static async getDrawingPDF(filePath: string): Promise<Blob> {
    try {
      const { data, error } = await supabase.storage
        .from('drawings')
        .download(filePath);
      
      if (error) {
        console.error('å›³é¢PDFãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:', error);
        throw new Error(`å›³é¢PDFã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
      }
      
      return data;
    } catch (error) {
      console.error('å›³é¢PDFãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
      throw error;
    }
  }
  
  /**
   * è¤‡æ•°å›³é¢ç•ªå·ã«ã‚ˆã‚‹ä¸€æ‹¬å–å¾—
   */
  static async getDrawingsByNumbers(drawingNumbers: string[]): Promise<Drawing[]> {
    if (drawingNumbers.length === 0) return [];
    
    try {
      const { data, error } = await supabase
        .from('drawings')
        .select('*')
        .in('drawing_number', drawingNumbers)
        .eq('is_active', true);
      
      if (error) {
        console.error('è¤‡æ•°å›³é¢å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
        throw new Error(`å›³é¢ã®ä¸€æ‹¬å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
      }
      
      return data || [];
    } catch (error) {
      console.error('è¤‡æ•°å›³é¢å–å¾—å‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
      throw error;
    }
  }
}
```

### **Step 4: å‹•ä½œç¢ºèªã¨ãƒ†ã‚¹ãƒˆ**

**ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§åŸºç›¤å®Ÿè£…ã®å‹•ä½œç¢ºèªã‚’è¡Œã£ã¦ãã ã•ã„:**

```powershell
# ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ
npm run build

if ($LASTEXITCODE -eq 0) {
    Write-Host "âœ… Phase 2åŸºç›¤å®Ÿè£… ãƒ“ãƒ«ãƒ‰æˆåŠŸï¼" -ForegroundColor Green
    
    # é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
    npm run dev
    Write-Host "ğŸ§ª http://localhost:5173 ã§å‹•ä½œç¢ºèªã—ã¦ãã ã•ã„" -ForegroundColor Yellow
    Write-Host "ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆF12ï¼‰ã§ã‚¨ãƒ©ãƒ¼ãŒãªã„ã“ã¨ã‚’ç¢ºèª" -ForegroundColor Cyan
} else {
    Write-Host "âŒ ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ã€‚å®Ÿè£…å†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„" -ForegroundColor Red
}
```

### **Step 5: ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã®æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ**

**é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•å¾Œã€ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆF12ï¼‰ã§ä»¥ä¸‹ã‚’ãƒ†ã‚¹ãƒˆ:**

```javascript
// PDFç”Ÿæˆæ©Ÿèƒ½ã®åŸºæœ¬ãƒ†ã‚¹ãƒˆ
(async () => {
  console.log('ğŸ§ª PDFæ©Ÿèƒ½åŸºç›¤ãƒ†ã‚¹ãƒˆé–‹å§‹');
  
  try {
    // OrderPDFGeneratorã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆç¢ºèª
    const { OrderPDFGenerator } = await import('/src/utils/pdfGenerator.ts');
    
    // ãƒ†ã‚¹ãƒˆç”¨ç™ºæ³¨ãƒ‡ãƒ¼ã‚¿
    const testOrderData = {
      id: 'test-id',
      order_no: 'PO-TEST-001',
      created_at: new Date().toISOString(),
      partner_name: 'å¯Œå£«ç²¾å·¥æ ªå¼ä¼šç¤¾',
      total_amount: 150000,
      notes: 'ãƒ†ã‚¹ãƒˆç”¨ç™ºæ³¨æ›¸ã§ã™ã€‚å¯Œå£«ç²¾å·¥æ§˜å‘ã‘ã®PDFç”Ÿæˆæ©Ÿèƒ½ç¢ºèªã€‚',
      items: [
        {
          product_name: 'ç²¾å¯†åŠ å·¥éƒ¨å“Aï¼ˆå›³é¢å¯¾å¿œï¼‰',
          drawing_number: 'DRW-A001-2025',
          quantity: 10,
          unit_price: 1500
        },
        {
          product_name: 'å°‚ç”¨æ²»å…·ã‚»ãƒƒãƒˆï¼ˆå›³é¢ç®¡ç†ï¼‰',
          drawing_number: 'DRW-JIG-001',
          quantity: 2,
          unit_price: 75000
        }
      ]
    };
    
    // PDFç”Ÿæˆãƒ†ã‚¹ãƒˆ
    const result = await OrderPDFGenerator.generateOrderPDF(testOrderData);
    
    if (result.success) {
      console.log('âœ… PDFç”ŸæˆæˆåŠŸ:', result.pdfBlob.size, 'bytes');
      console.log('âœ… ãƒ•ã‚¡ã‚¤ãƒ«å:', result.filename);
      
      // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ
      OrderPDFGenerator.downloadPDF(result.pdfBlob, result.filename);
      console.log('âœ… PDFãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å®Ÿè¡Œ');
      
    } else {
      console.error('âŒ PDFç”Ÿæˆå¤±æ•—:', result.error);
    }
    
  } catch (error) {
    console.error('âŒ PDFãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼:', error);
  }
})();
```

---

## **ğŸ“‹ Phase 2 å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**

### **ä»Šæ—¥å®Œäº†ã™ã¹ãã‚¿ã‚¹ã‚¯**
- [ ] `src/types/pdf.ts` ä½œæˆãƒ»å®Ÿè£…å®Œäº†
- [ ] `src/utils/pdfGenerator.ts` ä½œæˆãƒ»å®Ÿè£…å®Œäº†
- [ ] `src/api/drawings.ts` ä½œæˆãƒ»å®Ÿè£…å®Œäº†
- [ ] `npm run build` ã‚¨ãƒ©ãƒ¼ãªã—ç¢ºèª
- [ ] `npm run dev` æ­£å¸¸èµ·å‹•ç¢ºèª
- [ ] ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§PDFç”Ÿæˆãƒ†ã‚¹ãƒˆæˆåŠŸ

### **ä»Šé€±å®Œäº†äºˆå®š**
- [ ] å›³é¢ç®¡ç†UIå®Ÿè£…ï¼ˆ`src/pages/Drawings.tsx`ï¼‰
- [ ] ç™ºæ³¨ç”»é¢ã¸ã®å›³é¢ç•ªå·å…¥åŠ›æ©Ÿèƒ½è¿½åŠ 
- [ ] PDFç”Ÿæˆãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ã®çµ±åˆ
- [ ] å›³é¢ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»æ¤œç´¢æ©Ÿèƒ½ã®å‹•ä½œç¢ºèª

### **æ¥é€±é–‹å§‹äºˆå®š**
- [ ] Access ODBCæ¥ç¶šè¨­å®š
- [ ] Access VBAç™ºæ³¨ãƒ•ã‚©ãƒ¼ãƒ å®Ÿè£…
- [ ] ãƒ‡ãƒ¼ã‚¿ç§»è¡Œæ©Ÿèƒ½ã®å®Ÿè£…

---

## **ğŸš€ æ¬¡ã®å…·ä½“çš„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**

### **ä»Šã™ãå®Ÿè¡Œ**
1. ä¸Šè¨˜ã®3ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`pdf.ts`, `pdfGenerator.ts`, `drawings.ts`ï¼‰ã‚’ä½œæˆ
2. `npm run build` ã§ã‚¨ãƒ©ãƒ¼ãŒãªã„ã“ã¨ã‚’ç¢ºèª
3. `npm run dev` ã§é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
4. ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§PDFç”Ÿæˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

### **æˆåŠŸç¢ºèªå¾Œ**
```powershell
# Phase 2åŸºç›¤å®Ÿè£…ã®ã‚³ãƒŸãƒƒãƒˆ
git add .
git commit -m "feat(pdf): implement PDF generation and drawing management foundation

- Add comprehensive type definitions for PDF operations
- Implement OrderPDFGenerator with drawing attachment capability
- Add DrawingAPI with robust error handling and validation
- Include performance monitoring for PDF operations
- Complete Phase 2 foundation for Fujiseiko requirements"

Write-Host "âœ… Phase 2åŸºç›¤å®Ÿè£…å®Œäº†ï¼æ¬¡ã¯å›³é¢ç®¡ç†UIã®å®Ÿè£…ã§ã™" -ForegroundColor Green
```

**ã“ã®å®Ÿè£…ã«ã‚ˆã‚Šã€å¯Œå£«ç²¾å·¥æ§˜ã®ã€Œå›³é¢ç•ªå·å…¥åŠ›â†’ç™ºæ³¨æ›¸PDFè²¼ä»˜ã€è¦ä»¶ã®æŠ€è¡“çš„åŸºç›¤ãŒå®Œæˆã—ã¾ã™ã€‚å“è³ªé‡è¦–ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ã‚‚å«ã¾ã‚Œã¦ãŠã‚Šã€ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç’°å¢ƒã§ã®å®‰å®šå‹•ä½œãŒæœŸå¾…ã§ãã¾ã™ã€‚** ğŸš€