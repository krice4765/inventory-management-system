# 🚀 本格運用開始チェックリスト

**対象**: SuperClaude Framework 分納管理システム  
**実行日**: 2025年9月5日  
**実行者**: システム管理者・運用担当者

---

## 📋 実行手順

### Step 1: 必須前提条件の確認

#### 1.1 環境変数の確認
```bash
# プロジェクトルートで実行
cat .env

# 確認項目:
# ✅ VITE_SUPABASE_URL が設定されている
# ✅ VITE_SUPABASE_ANON_KEY が設定されている
```

#### 1.2 PostgRESTスキーマリロード（**必須**）
```
1. Supabase Dashboard にログイン
2. Settings → API → "Reload schema cache" ボタンをクリック
3. リロード完了まで約30秒待機
```

#### 1.3 DB関数・ビューの存在確認
```sql
-- Supabase SQL Editor で実行
\i db_validation_check.sql

-- 期待される結果:
-- ✅ RPC関数: add_purchase_installment_secure, list_staff_members 存在
-- ✅ ビュー: v_order_payment_summary, v_system_dashboard 存在  
-- ✅ セキュリティ: RLS が有効
-- ✅ テストデータ: 発注・担当者データが存在
```

### Step 2: 段階的テスト実行

#### 2.1 開発サーバー起動
```bash
# プロジェクトルートで実行
npm run dev

# ブラウザで確認:
# http://localhost:5173 でアプリ起動を確認
```

#### 2.2 コンソールでの直接テスト
```javascript
// ブラウザの開発者コンソールで実行

// 1. Supabaseクライアント確認
console.log('Supabase Client:', window.supabase || 'Not found');

// 2. 直接RPC実行テスト
supabase.rpc('list_staff_members', { p_only_active: true })
  .then(result => console.log('✅ Staff List:', result))
  .catch(error => console.error('❌ Staff List Error:', error));

// 3. ビューアクセステスト
supabase.from('v_system_dashboard').select('*').maybeSingle()
  .then(result => console.log('✅ System Health:', result))
  .catch(error => console.error('❌ System Health Error:', error));
```

#### 2.3 テストダッシュボードでのAPI統合テスト
```
1. http://localhost:5173/testing にアクセス
2. 「🚀 全テスト実行」ボタンをクリック  
3. 結果確認（期待値）:
   ✅ P0001エラーハンドリングテスト: 「分納金額が上限を超過しています」メッセージ表示
   🔶 分納作成成功テスト: 残額のある発注がある場合のみ成功  
   ✅ 担当者一覧取得テスト: 担当者データの正常取得
   ✅ システムヘルスチェックテスト: システム状態の正常取得
```

---

## ✅ 技術基盤確認チェックリスト

### データベース基盤
- [ ] **修正版コード適用**: api-test.ts と TestingDashboard.tsx の修正版適用完了
- [ ] **PostgRESTリロード**: 新しいRPC関数・ビューがAPI利用可能
- [ ] **DB関数存在確認**: add_purchase_installment_secure, list_staff_members が動作
- [ ] **ビュー存在確認**: v_order_payment_summary, v_system_dashboard がアクセス可能
- [ ] **RLS設定確認**: purchase_orders, installments, staff_members でRLS有効

### API統合テスト
- [ ] **テストダッシュボード**: 修正後のテストで期待される成功/失敗パターン確認
- [ ] **P0001エラーハンドリング**: 「分納金額が上限を超過しています」と表示
- [ ] **担当者一覧**: list_staff_members RPC で担当者データ正常取得
- [ ] **システムヘルス**: v_system_dashboard ビューでヘルス情報正常取得
- [ ] **応答速度**: 500ms以内の応答時間達成

### セキュリティ
- [ ] **環境変数設定**: .envファイルでSupabase接続情報が正しく設定
- [ ] **SECURITY DEFINER**: RPC関数が適切な権限で実行
- [ ] **データアクセス制御**: RLS により直接テーブルアクセス制限
- [ ] **エラー情報保護**: 技術詳細の漏洩防止

---

## ✅ 運用体制確認チェックリスト  

### 監視・保守体制
- [ ] **日次チェック体制**: daily_health_check.sql の実行担当者決定
- [ ] **緊急時連絡先**: 障害発生時のエスカレーション体制確立  
- [ ] **バックアップ確認**: Supabase の自動バックアップ設定確認
- [ ] **監視しきい値**: システムヘルス監視の基準値設定（健康度スコア85点以上）

### 運用手順
- [ ] **運用マニュアル**: WEBUI_OPERATION_MANUAL.md の内容理解・実行準備
- [ ] **障害対応**: P0/P1/P2 レベル別対応手順の理解
- [ ] **定期メンテナンス**: 週次・月次メンテナンス項目の実行計画
- [ ] **エスカレーション**: 連絡体制と報告書テンプレートの準備

---

## ✅ ユーザビリティ確認チェックリスト

### 操作性・応答性
- [ ] **直感的操作**: 分納追加・確認の操作性確認
- [ ] **エラー表示**: 技術エラーのユーザーフレンドリー変換確認
- [ ] **応答速度**: 500ms以内の応答時間達成確認
- [ ] **リアルタイム更新**: 分納追加後の残高表示即座更新

### データ品質・整合性
- [ ] **分納計算精度**: 数学的整合性100%確認（残額 = 発注額 - 分納合計）
- [ ] **P0001エラー**: 超過額での分納時に適切なエラー表示
- [ ] **担当者管理**: 統一マスタからの担当者一覧取得
- [ ] **状態同期**: フロントエンド表示とDB状態の完全同期

---

## 🎯 成功基準と次のステップ

### 即座確認項目（必須）
- [ ] **修正版テスト実行**: 全テストが期待される結果（成功/失敗パターン）で完了
- [ ] **P0001エラー表示**: ユーザーフレンドリーなメッセージ表示確認  
- [ ] **システム応答**: 500ms以内の応答時間達成
- [ ] **データ整合性**: 分納計算の数学的正確性確認

### 運用準備項目（推奨）
- [ ] **監視ダッシュボード**: ヘルスチェック結果の定期確認
- [ ] **障害対応訓練**: P1レベル障害の模擬対応実施
- [ ] **運用手順習熟**: 日次・週次作業の実際実行
- [ ] **ユーザー教育**: エラー対応・操作方法の説明資料作成

---

## 🚨 緊急時対応準備

### 連絡体制
```
P0 (緊急): システム停止・データ破損
└─ 5分以内 → システム管理者 → 15分で復旧見込み不明 → 全責任者

P1 (高): 主要機能停止・大量エラー  
└─ 15分以内 → 運用責任者 → 30分で復旧見込み不明 → 技術・事業責任者

P2 (中): 性能劣化・軽微な不具合
└─ 30分以内 → システム管理者 → 2時間で復旧見込み不明 → システム管理者
```

### 必須準備項目
- [ ] **緊急連絡先**: 各レベル責任者の連絡先確認
- [ ] **復旧手順**: バックアップからの復旧手順理解
- [ ] **代替運用**: 手動処理での業務継続手順準備
- [ ] **状況報告**: 障害報告書テンプレートの準備

---

## 🎊 本格運用開始判定

### ✅ 全項目完了時
**🎉 本格運用開始可能！**
- システムは安定動作し、運用体制が確立されています
- SuperClaude Framework 多層防御システムが完全に機能します
- エンタープライズレベルの品質・安定性を達成しています

### ⚠️ 未完了項目がある場合
**🔧 修正完了後に再チェック**
- 未完了項目を優先度順に解決してください
- 技術的問題は該当SQLスクリプトを実行してください
- 運用体制の問題は責任者・手順を明確化してください

---

## 📞 サポート・参考資料

### 技術資料
- **運用マニュアル**: `WEBUI_OPERATION_MANUAL.md`
- **DB検証スクリプト**: `scripts/db_validation_check.sql`  
- **日次チェックスクリプト**: `scripts/daily_health_check.sql`
- **包括的解決レポート**: `COMPREHENSIVE_ISSUES_RESOLUTION_REPORT.md`

### 緊急時参考
- **障害対応ガイド**: 運用マニュアル「障害対応ガイド」章
- **エスカレーション基準**: 運用マニュアル「連絡体制・エスカレーション」章  
- **復旧手順**: 運用マニュアル「保守・メンテナンス」章

---

**最終確認者サイン**: ________________  **確認日時**: ________________

**本格運用開始承認**: ________________  **承認日時**: ________________