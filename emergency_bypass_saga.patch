// ç·Šæ€¥å¯¾å¿œ: Sagaã‚·ã‚¹ãƒ†ãƒ ã®ãƒã‚¤ãƒ‘ã‚¹
// ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’DeliveryModal.tsxã®è©²å½“éƒ¨åˆ†ã«ç½®ãæ›ãˆã‚‹

// ğŸš¨ ç·Šæ€¥å¯¾å¿œ: ã‚·ãƒ³ãƒ—ãƒ«åˆ†ç´ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ç”¨
console.log('ğŸš¨ ç·Šæ€¥å¯¾å¿œ: ã‚·ãƒ³ãƒ—ãƒ«åˆ†ç´ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ç”¨');

const simplifiedData = {
  orderId: orderData.purchase_order_id,
  amount: data.amount,
  deliveryType: data.deliveryType || 'amount_only',
  quantities: data.quantities,
  userId: 'current-user',
  memo: data.memo
};

console.log('ğŸ“ ã‚·ãƒ³ãƒ—ãƒ«åˆ†ç´ãƒ‡ãƒ¼ã‚¿:', simplifiedData);

const installmentResult = await createInstallment(simplifiedData);

if (!installmentResult.success) {
  throw new Error(installmentResult.error || 'ã‚·ãƒ³ãƒ—ãƒ«åˆ†ç´å‡¦ç†å¤±æ•—');
}

console.log('âœ… ã‚·ãƒ³ãƒ—ãƒ«åˆ†ç´å‡¦ç†æˆåŠŸ:', installmentResult);

// Sagaã®ä»£ã‚ã‚Šã«ã‚·ãƒ³ãƒ—ãƒ«ãªçµæœã‚’è¿”ã™
return {
  deliveredAmount: data.amount,
  memo: data.memo,
  deliveryType: data.deliveryType,
  quantities: data.quantities,
  transactionId: installmentResult.transactionId,
  deliverySequence: nextSequence
};